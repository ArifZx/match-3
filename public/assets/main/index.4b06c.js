System.register("chunks:///main.js",["cc"],(function(){"use strict";var e,t,n,i,o,r,a,l,s,c,u,h,p,f,d,v,b,g,m,A,y,w,E,T,R,P,L;return{setters:[function(C){e=C.cclegacy,t=C._decorator,n=C.Sprite,i=C.Label,o=C.math,r=C.tween,a=C.Component,l=C.EventTarget,s=C.instantiate,c=C.Enum,u=C.SpriteFrame,h=C.Prefab,p=C.AnimationClip,f=C.Node,d=C.UITransform,v=C.AnimationComponent,b=C.Vec3,g=C.resources,m=C.assetManager,A=C.find,y=C.path,w=C.AudioSource,E=C.AudioClip,T=C.game,R=C.Vec2,P=C.Button,L=C.director}],execute:function(){function C(e,t,n,i,o,r,a){try{var l=e[r](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(i,o)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){C(r,i,o,a,l,"next",e)}function l(e){C(r,i,o,a,l,"throw",e)}a(void 0)}))}}function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t,n){return t&&F(e.prototype,t),n&&F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,D(e,t)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function k(e,t,n,i,o){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var U,V,z,x,B,I,G,X,H;e._RF.push({},"c2a9emdCZ1GaaauoqkLXNyb","HealthComponent",void 0);var Y,W,Q,j=t.ccclass,K=t.property,J=(U=j("HealthComponent"),V=K(n),z=K(i),U((I=k((B=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"healthSprite",I,O(t)),N(t,"healthLabel",G,O(t)),N(t,"maxHealth",X,O(t)),N(t,"health",H,O(t)),t.prevHealth=t.health,t}M(t,e);var n=t.prototype;return n.drawHealth=function(e,t){var n=this;void 0===e&&(e=this.percent),void 0===t&&(t=.3);var i=o.clamp01(e);if(this.healthSprite.isValid){var a=this.healthSprite.node,l=a.scale.clone();l.set(i,l.y,l.z),r(a).to(t,{scale:l}).start(),r(this).to(t,{prevHealth:i*this.maxHealth},{onUpdate:function(){n.healthLabel.isValid&&(n.healthLabel.string=n.prevHealth.toFixed(0))},onComplete:function(){n.healthLabel.isValid&&(n.healthLabel.string=n.prevHealth.toFixed(0))}}).start()}},n.start=function(){this.drawHealth(this.percent,.1)},_(t,[{key:"percent",get:function(){return this.health/this.maxHealth}}]),t}(a)).prototype,"healthSprite",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=k(B.prototype,"healthLabel",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=k(B.prototype,"maxHealth",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),H=k(B.prototype,"health",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),x=B))||x);e._RF.pop(),e._RF.push({},"a826eQ/3t9PApZXcT2ncZiB","BoardEnums",void 0),function(e){e[e.PREPARING=0]="PREPARING",e[e.READY_FOR_MOVE=1]="READY_FOR_MOVE",e[e.POPPING=2]="POPPING",e[e.SPAWNING_NEW_TILES=3]="SPAWNING_NEW_TILES"}(Y||(Y={})),e._RF.pop(),e._RF.push({},"1ea57CbwLxPB7cSic0eV6lb","PoolComponent",void 0);var q=t.ccclass,Z=(t.property,q("PoolComponent")(((Q=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).eventTarget=new l,t}M(t,e);var n=t.prototype;return n.remove=function(e){void 0===e&&(e=!0),e&&this.node.removeFromParent(),this.eventTarget.emit(t.EventType.REMOVE,this)},n.pick=function(){this.eventTarget.emit(t.EventType.PICK,this)},t}(a)).EventType={REMOVE:"remove-pool",PICK:"pick-pool"},W=Q))||W);e._RF.pop(),e._RF.push({},"7c361JWEoFNEJkhRiUztGrs","PoolManager",void 0);var $,ee,te,ne,ie,oe,re,ae,le,se,ce,ue,he,pe,fe,de,ve,be,ge=function(){function e(){this.prefab=null,this.pool=[]}var t=e.prototype;return t.testPoolComponent=function(e){var t=e.getComponent(Z);return t||e.addComponent(Z)},t.addToPool=function(e){this.pool.push(e)},t.pickOne=function(){if(!this.pool.length){var e,t=this.spawnObject();return null==(e=t.getComponent(Z))||e.pick(),t}return this.pool.shift()},t.spawnObject=function(){var e=this;if(!this.prefab)throw new Error("Please initialize prefab pool");var t=s(this.prefab),n=this.testPoolComponent(t);return n.eventTarget.on(Z.EventType.REMOVE,(function(t){e.addToPool(t)})),n.eventTarget.on(Z.EventType.PICK,(function(t){var n=e.pool.indexOf(t);n<0||e.pool.splice(n,1)})),t},e}();e._RF.pop(),e._RF.push({},"a2e75wGa1xOT7JfbaQ3PFt9","TileEnums",void 0),function(e){e[e.BLUE=0]="BLUE",e[e.GREEN=1]="GREEN",e[e.GREY=2]="GREY",e[e.PINK=3]="PINK",e[e.RED=4]="RED",e[e.YELLOW=5]="YELLOW"}($||($={})),c($),function(e){e[e.NORMAL=0]="NORMAL",e[e.PUSHED=1]="PUSHED",e[e.SELECTED=2]="SELECTED",e[e.MATCHED=3]="MATCHED"}(ee||(ee={})),c(ee),e._RF.pop(),e._RF.push({},"bb3ec6e08dPZZthXHkBHle8","TileComponent",void 0);var me,Ae,ye,we,Ee,Te,Re,Pe,Le,Ce,Se,Fe,_e,Me,De,Oe,Ne=t.ccclass,ke=t.property,Ue=t.requireComponent,Ve=(te=Ne("TileComponent"),ne=Ue(n),ie=ke({type:$}),oe=ke({type:ee}),re=ke([u]),ae=ke([u]),le=ke(h),se=ke([p]),te(ce=ne((he=k((ue=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"type",he,O(t)),N(t,"state",pe,O(t)),N(t,"baseSprite",fe,O(t)),N(t,"pushedSprite",de,O(t)),N(t,"connect",ve,O(t)),t.connectNode=null,t.sprite=void 0,t.label=null,N(t,"animClips",be,O(t)),t.row=-1,t.col=-1,t.mark=0,t}M(t,e);var o=t.prototype;return o.onLoad=function(){this.sprite=this.getComponent(n),this.getFXNode(),this.setState(this.state),this.initializeConnect()},o.start=function(){},o.getBoardID=function(){return this.row*Math.pow(10,3)+this.col},o.reset=function(){this.row=-1,this.col=-1,this.resetState(),this.showConnect(!1)},o.resetState=function(){this.setState(ee.NORMAL)},o.getFXNode=function(){var e=this.node.getChildByName("FX");if(!e){(e=new f).name="FX",e.setParent(this.node),e.layer=this.node.layer;var t=e.addComponent(d);t.setContentSize(88,98),t.setAnchorPoint(.5,.5),e.addComponent(n);var i=e.addComponent(v);this.animClips.forEach((function(e){i.addClip(e)}))}return e},o.initializeConnect=function(){if(this.connect){var e=s(this.connect);e.name="connect",e.setParent(this.node),this.connectNode=e,this.showConnect(!1)}},o.initializeLabel=function(){var e=new f("label");e.setParent(this.node),e.layer=this.node.layer;var t=e.addComponent(i);this.label=t,this.setMark()},o.setMark=function(e){var t;if(void 0===e&&(e=this.mark),this.mark!==e&&void 0!==e&&(this.mark=e),null!=(t=this.label)&&t.node.isValid){var n=-1===e?"ðŸ’¡":0===e?"":this.mark.toString();this.label.string=n}},o.setLabelStr=function(e){var t;null!=(t=this.label)&&t.node.isValid&&(this.label.string=e)},o.connectPreviousTile=function(e,t){var n;if(void 0===t&&(t=!0),null!=e&&null!=(n=e.node)&&n.isValid){this.showConnect(t);var i=e.node,o=new b;b.subtract(o,i.position,this.node.position),b.normalize(o,o);var r=Math.atan2(o.y,o.x);this.rotateConnect(180*r/Math.PI-90)}else this.showConnect(!1)},o.showConnect=function(e){void 0===e&&(e=!0);var t=this.connectNode;t&&t.isValid&&(t.active=e)},o.rotateConnect=function(e){var t=this.connectNode;t&&t.isValid&&t.setRotationFromEuler(0,0,e)},o.setState=function(e){var t,n,i=this.getFXNode(),o=i.getComponent(v);e===ee.MATCHED?i.setPosition(-4,0,0):i.setPosition(0,0,0),i.active=e>1;var r=globalThis.WEBP_SUPPORT;switch(e){case ee.MATCHED:o.play((null==(t=o.clips[r?1:3])?void 0:t.name)||"");break;case ee.SELECTED:o.play((null==(n=o.clips[r?0:2])?void 0:n.name)||"");break;case ee.PUSHED:this.sprite.spriteFrame=this.pushedSprite[r?0:1];break;default:this.sprite.spriteFrame=this.baseSprite[r?0:1]}this.state=e},t}(a)).prototype,"type",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $.GREY}}),pe=k(ue.prototype,"state",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ee.NORMAL}}),fe=k(ue.prototype,"baseSprite",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),de=k(ue.prototype,"pushedSprite",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ve=k(ue.prototype,"connect",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=k(ue.prototype,"animClips",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ce=ue))||ce)||ce);e._RF.pop(),e._RF.push({},"2272dYMsvpCqrzNl6Jot7DB","TileManager",void 0);var ze=t.ccclass,xe=t.property,Be=t.executionOrder,Ie=(me=ze("TileManager"),Ae=Be(0),ye=xe(h),we=xe(h),Ee=xe(h),Te=xe(h),Re=xe(h),Pe=xe(h),me(Le=Ae((Se=k((Ce=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).tileAssets={},N(t,"blue",Se,O(t)),N(t,"grey",Fe,O(t)),N(t,"green",_e,O(t)),N(t,"pink",Me,O(t)),N(t,"red",De,O(t)),N(t,"yellow",Oe,O(t)),t.pools={},t}M(t,e);var n=t.prototype;return n.onLoad=function(){var e=this;this.tileAssets[$.BLUE]="BLUE",this.tileAssets[$.GREEN]="Green",this.tileAssets[$.GREY]="GREY",this.tileAssets[$.PINK]="PINK",this.tileAssets[$.RED]="RED",this.tileAssets[$.YELLOW]="YELLOW",Object.keys(this.tileAssets).forEach((function(t){var n=new ge;n.prefab=e.getPrefab(+t),e.pools[+t]=n}))},n.assetKey=function(e){return"Tile_"+$[e]},n.getAssetKey=function(e,t){void 0===t&&(t=0);var n=this.tileAssets[e];return 0===t?n:1===t?n.toUpperCase():n.toLowerCase()},n.parseTile=function(e){return"images/"+this.tileAssets[e]+"/spriteFrame"},n.loadAssets=function(){var e=this;Object.keys(this.tileAssets).forEach((function(t){var n=e.parseTile(t);g.get(n,u)||g.load(n,u,(function(n,i){n||m.assets.add(e.assetKey(+t),i)}))}))},n.getPrefab=function(e){var t=this.grey;switch(e){case $.BLUE:t=this.blue;break;case $.GREY:t=this.grey;break;case $.GREEN:t=this.green;break;case $.PINK:t=this.pink;break;case $.RED:t=this.red;break;case $.YELLOW:t=this.yellow}return t},n.spawnRandomTile=function(e){var t;for(void 0===e&&(e=[$.GREY]);!t||!$[t]||-1!==e.indexOf(t);)t=Math.floor(6*Math.random());return this.spawnTile(t)},n.spawnTile=function(e){var t=this.pools[e];if(!t)throw new Error("Tile not found");var n=t.pickOne();return n.name="Tile",n.getComponent(Ve)},_(t,null,[{key:"instance",get:function(){var e,n=null==(e=A(y.join("TileManager")))?void 0:e.getComponent(t);if(!n)throw new Error("Add TileManager on scene first");return n}}]),t}(a)).prototype,"blue",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=k(Ce.prototype,"grey",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=k(Ce.prototype,"green",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=k(Ce.prototype,"pink",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),De=k(Ce.prototype,"red",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=k(Ce.prototype,"yellow",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=Ce))||Le)||Le);e._RF.pop(),e._RF.push({},"4a297IPpxVMqrWACKwt4Iua","BoardUtil",void 0);var Ge,Xe=72.5,He=85;function Ye(e,t,n,i,o){void 0===n&&(n={x:0,y:0}),void 0===i&&(i=Xe),void 0===o&&(o=He);var r=t.col*i/2-i/2,a=o/2;return n.x=e.col*i-r,n.y=e.row*o+(e.col%2==1?o/2:0)+a,n}function We(e,t,n,i,o){void 0===n&&(n={row:0,col:0}),void 0===i&&(i=Xe),void 0===o&&(o=He);var r=t.col*i/2-i/2,a=o/2,l=Math.round((e.x+r)/i);0===l&&(l=0);var s=Math.round((e.y-((l%2==1?o/2:0)+a))/o);return 0===s&&(s=0),n.col=l,n.row=s,n}function Qe(e,t){return e.row*t.col+e.col}function je(e,t,n){return void 0===n&&(n=!0),function(e,t,n,i,o){void 0===o&&(o=!0);var r,a=i-t,l=n-e;r=o===(t%2==0)?nt:it;for(var s=!1,c=1,u=0,h=0;c<r.length;c+=2)if(u=r[c-1],h=r[c],u===l&&h===a){s=!0;break}return s}(e.row,e.col,t.row,t.col,n)}!function(e){e[e.U=0]="U",e[e.UR=1]="UR",e[e.DR=2]="DR",e[e.D=3]="D",e[e.DL=4]="DL",e[e.UL=5]="UL"}(Ge||(Ge={}));var Ke,Je,qe,Ze,$e,et,tt,nt=[1,0,0,1,-1,1,-1,0,-1,-1,0,-1],it=[1,0,1,1,0,1,-1,0,0,-1,1,-1];function ot(e,t,n){void 0===n&&(n=!0);var i,o=[];i=n===(e.col%2==0)?nt:it;var r=[];!function(e,t,n){void 0===n&&(n=[]);var i=t.row/2,o=t.col/2,r=e.row-i,a=e.col-o;r<0&&a<0?n.push(Ge.U,Ge.D,Ge.UR,Ge.DR,Ge.UL,Ge.DL):r<0&&a>0?n.push(Ge.U,Ge.D,Ge.UL,Ge.DL,Ge.UR,Ge.DR):r>0&&a<0?n.push(Ge.D,Ge.U,Ge.DR,Ge.UR,Ge.DL,Ge.UL):r>0&&a>0?n.push(Ge.D,Ge.U,Ge.DL,Ge.UL,Ge.DR,Ge.UR):n.push(Ge.U,Ge.UR,Ge.DR,Ge.D,Ge.DL,Ge.UL)}(e,t,r);for(var a=0,l=0,s=0,c=0;a<r.length;a++)if(s=i[2*(l=r[a])]+e.row,c=i[2*l+1]+e.col,!(s<0||c<0||s>=t.row||c>=t.col)){var u=Qe({row:s,col:c},t);o.push(t.tiles[u])}return o}e._RF.pop(),e._RF.push({},"8e3f2JipXFHuZNw4a7FTi09","SoundManager",void 0);var rt,at,lt,st,ct,ut,ht,pt,ft,dt,vt,bt,gt,mt,At,yt,wt,Et,Tt,Rt,Pt,Lt,Ct,St,Ft=t.ccclass,_t=t.property,Mt=t.requireComponent,Dt=(Ke=Ft("SoundManager"),Je=Mt(w),qe=_t([E]),Ke(Ze=Je(((tt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"clips",et,O(t)),t}return M(t,e),t.prototype.onLoad=function(){var e;T.addPersistRootNode(this.node),null!=(e=t._audioSource)&&e.isValid||(t._audioSource=this.getComponent(w))},t.playSound=function(e){var n,i=this.instance;if(null!=i&&i.isValid){var o=i.clips[e];if(null!=o&&o.isValid&&null!=(n=t._audioSource)&&n.isValid){var r=t._audioSource;r.playing&&r.stop(),r.clip=o,r.play()}}},t.stop=function(){var e=this.instance;null!=e&&e.isValid&&this._audioSource.isValid&&this._audioSource.playing&&this._audioSource.stop()},_(t,null,[{key:"instance",get:function(){var e;return this._instance||(this._instance=(null==(e=A("SoundManager"))?void 0:e.getComponent(t))||new t),this._instance}}]),t}(a))._instance=void 0,tt._audioSource=void 0,et=k(($e=tt).prototype,"clips",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ze=$e))||Ze)||Ze);e._RF.pop(),e._RF.push({},"db39cdbnalPsphRK09/h0sU","BoardComponent",void 0);var Ot,Nt,kt,Ut,Vt,zt,xt,Bt,It,Gt,Xt,Ht,Yt=t.ccclass,Wt=t.property,Qt=t.executionOrder;rt=Yt("BoardComponent"),at=Qt(1),lt=Wt({min:0}),st=Wt({min:0}),ct=Wt(f),ut=Wt(J),ht=Wt(i),pt=Wt(i),ft=Wt(w),dt=Wt(w),vt=Wt(w),bt=Wt(w),rt(gt=at((At=k((mt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"row",At,O(t)),N(t,"col",yt,O(t)),N(t,"moveTargetNode",wt,O(t)),N(t,"healthComponent",Et,O(t)),N(t,"levelLabel",Tt,O(t)),t.level=1,N(t,"damageLabel",Rt,O(t)),t.positions=[],t.tiles=[],t.selectedTiles=[],t.transform=void 0,t.state=Y.PREPARING,t.eventTarget=new l,N(t,"nextLevelFX",Pt,O(t)),N(t,"selectFX",Lt,O(t)),N(t,"startMoveFX",Ct,O(t)),N(t,"damageFX",St,O(t)),t}M(t,e);var n=t.prototype;return n.onLoad=function(){this.transform=this.getComponent(d),this.initialize(),Dt.stop(),this.scheduleOnce((function(){Dt.playSound(1)}),.5)},n.initialize=function(){this.positions=function(e,t,n,i){void 0===n&&(n=Xe),void 0===i&&(i=He);for(var o=t*n/2-n/2,r=i/2,a=[],l=0;l<e;l++)for(var s=0;s<t;s++){0===s&&(a[l]=[]);var c=s*n-o,u=l*i+(s%2==1?i/2:0)+r;a[l][s]={x:c,y:u}}return a}(this.row,this.col),this.initTiles(),this.setupTouchEvents(),this.setupEvents(),this.state=Y.READY_FOR_MOVE},n.setupEvents=function(){var e=this;this.eventTarget.on("on-change-state",(function(t){t===Y.SPAWNING_NEW_TILES&&e.dropTiles()}))},n.dropTiles=function(){for(var e,t=this,n=0,i=0,o=0;o<this.col;o++){n=0;for(var r=0;r<this.row;r++){var a;if(i=Qe({row:r,col:o},this),null==(a=e=this.tiles[i])||a.setMark(0),e?n&&this.moveTile(e,{col:o,row:e.row-n}):n++,r===this.row-1)for(var l=n-1;l>=0;l--)this.spawnTile({row:r-l,col:o})}}this.scheduleOnce((function(){t.setState(Y.READY_FOR_MOVE)}),1.5)},n.calcDamage=function(e){for(var t=0,n=1;n<=e;n++)t+=10*n;return t},n.initTiles=function(){this.tiles.forEach((function(e){var t;null==(t=e.getComponent(Z))||t.remove(!0)}));for(var e=0;e<this.positions.length;e++)for(var t=0;t<((null==(n=this.positions[e])?void 0:n.length)||0);t++){var n,i=Ie.instance.spawnRandomTile(),o=this.positions[e][t];i.row=e,i.col=t,i.node.setPosition(o.x,o.y),i.node.setParent(this.node);var r=Qe({row:e,col:t},this);this.tiles[r]=i}},n.setState=function(e){this.state=e,this.eventTarget.emit("on-change-state",e,this)},n.getLocalPosFromTouch=function(e,t,n){n.getUILocation(t),e.set(t.x,t.y,0),this.node.inverseTransformPoint(e,e)},n.selectTile=function(e,t){if(void 0===t&&(t=!1),t||this.state===Y.READY_FOR_MOVE){var n=Qe(e,this),i=this.tiles[n],o=this.selectedTiles[this.selectedTiles.length-1];if(i&&null!=i&&i.node.isValid&&i!==o){if(o){if(i.type!==o.type)return;if(!je(o,i))return;var r;if(this.selectedTiles[this.selectedTiles.length-2]===i)return this.selectedTiles.splice(-1),o.setState(ee.NORMAL),o.showConnect(!1),o.node.setSiblingIndex(0),i.node.removeFromParent(),this.node.addChild(i.node),2===this.selectedTiles.length?(this.selectedTiles.forEach((function(e){return e.setState(ee.SELECTED)})),this.updateDamageLabel(!1)):this.selectedTiles.length>2?this.updateDamageLabel(!0,i):this.updateDamageLabel(!1),void((null==(r=this.selectFX)?void 0:r.isValid)&&this.selectFX.play())}if(-1===this.selectedTiles.indexOf(i)){this.selectedTiles.push(i),i.connectPreviousTile(o),i.node.removeFromParent(),this.node.addChild(i.node),i.setState(ee.PUSHED);var a=this.selectedTiles.length>=3;3===this.selectedTiles.length&&this.selectedTiles.forEach((function(e){return e.setState(ee.MATCHED)})),a?(i.setState(ee.MATCHED),this.updateDamageLabel(!0,i)):(i.setState(ee.SELECTED),this.updateDamageLabel(!1))}}}},n.updateDamageLabel=function(e,t){var n,i;if(null!=(n=this.damageLabel)&&n.isValid&&(e===this.damageLabel.node.active||(this.damageLabel.node.active=e,e))&&((null==(i=this.selectFX)?void 0:i.isValid)&&this.selectFX.play(),null!=t&&t.isValid)){var o=t.col<this.col/2;this.damageLabel.node.setPosition(t.node.position.clone().add3f(o?100:-100,0,0)),this.damageLabel.string=this.calcDamage(this.selectedTiles.length).toFixed(0),this.damageLabel.node.removeFromParent(),this.damageLabel.node.setParent(this.node)}},n.animMoveTiles=function(e,t){var n=this;this.setState(Y.POPPING);var i=b.ONE.clone().multiplyScalar(.5),o=0;e.forEach((function(e,a,l){var s=1+.03*a*Math.random();o=Math.max(o,s),r(e.node).to(s,{position:t,scale:i},{easing:"backIn",onStart:function(){var s;(null==(s=n.startMoveFX)?void 0:s.isValid)&&n.startMoveFX.play();var c,u=Qe(e,n);(n.tiles[u]=void 0,e.showConnect(!1),a===l.length-1)&&(null!=(c=n.damageLabel)&&c.isValid&&r(n.damageLabel.node).to(o,{position:t,scale:i},{easing:"backIn",onComplete:function(){n.damageLabel.node.active=!1,n.damageLabel.node.scale.set(1,1,1)}}).start())},onComplete:function(){var t;e.reset(),(null==(t=n.damageFX)?void 0:t.isValid)&&n.damageFX.play();var i=e.node.getComponent(Z);if(i&&(i.remove(!0),a===l.length-1)){var o,r;if(n.setState(Y.SPAWNING_NEW_TILES),null==(o=n.healthComponent)||!o.isValid)return;if(n.healthComponent.health-=n.calcDamage(a+1),n.healthComponent.health<=0)n.healthComponent.health=0,null!=(r=n.nextLevelFX)&&r.isValid&&n.nextLevelFX.play();n.healthComponent.drawHealth(),n.scheduleOnce((function(){var e;n.healthComponent.health<=0&&(null!=(e=n.levelLabel)&&e.isValid&&(n.levelLabel.string="Level "+ ++n.level),n.healthComponent.maxHealth=2*n.healthComponent.maxHealth,n.healthComponent.health=n.healthComponent.maxHealth,n.healthComponent.drawHealth())}),.5)}}}).start()}))},n.finishSelect=function(){if(this.selectedTiles.length<3)this.clearSelectedTiles();else{var e=this.moveTargetNode.worldPosition.clone();this.node.inverseTransformPoint(e,e),this.animMoveTiles(this.selectedTiles.splice(0),e)}},n.clearSelectedTiles=function(){for(;this.selectedTiles.length;){var e=this.selectedTiles.pop();null==e||e.setState(ee.NORMAL),null==e||e.showConnect(!1)}},n.setupTouchEvents=function(){var e=this,t=new R,n=new b,i={row:0,col:0};this.node.on(f.EventType.TOUCH_START,(function(o){e.getLocalPosFromTouch(n,t,o),We(n,e,i),e.selectTile(i)})),this.node.on(f.EventType.TOUCH_MOVE,(function(o){e.getLocalPosFromTouch(n,t,o),We(n,e,i),e.selectTile(i)})),this.node.on(f.EventType.TOUCH_END,(function(t){e.finishSelect()})),this.node.on(f.EventType.TOUCH_CANCEL,(function(e){}))},n.spawnTile=function(e,t,n){var i,o;null==(i=o=void 0!==t?Ie.instance.spawnTile($.BLUE):Ie.instance.spawnRandomTile())||i.setMark(0);var r=Ye({row:this.row+2,col:e.col},this);o.node.setPosition(r.x,r.y,0),o.node.setScale(1,1,1),o.node.setParent(this.node),this.moveTile(o,e,.5,"circIn",n)},n.moveTile=function(e,t,n,i,o){var a=this;void 0===n&&(n=.5),void 0===i&&(i="backIn");var l={x:0,y:0};Ye(t,this,l);var s=new b(l.x,l.y,0);r(e.node).to(n,{position:s},{easing:i,onStart:function(){var e;(null==(e=a.startMoveFX)?void 0:e.isValid)&&a.startMoveFX.play()},onComplete:function(){var n=Qe(t,a);a.tiles[n]=e,e.row=t.row,e.col=t.col,"function"==typeof o&&o()}}).start()},n.shuffle=function(e){var t=this;if(this.state===Y.READY_FOR_MOVE){var n=e.target,i=n instanceof f&&(null==n?void 0:n.getComponent(P));null!=i&&i.node.isValid&&(i.interactable=!1),this.setState(Y.PREPARING),this.tiles=this.tiles.sort((function(e,t){return.5-Math.random()})),this.clearSelectedTiles(),this.tiles.forEach((function(e,n){var i=function(e,t,n){return{row:Math.floor(e/t),col:e%n}}(n,t.row,t.col);t.moveTile(e,i,.5,"linear")})),this.scheduleOnce((function(){null!=i&&i.node.isValid&&(i.interactable=!0),t.setState(Y.READY_FOR_MOVE)}),.6)}},n.solve=function(e){var t=this;if(this.state===Y.READY_FOR_MOVE){var n=e.target,i=n instanceof f&&(null==n?void 0:n.getComponent(P));null!=i&&i.node.isValid&&(i.interactable=!1),this.setState(Y.PREPARING),this.clearSelectedTiles(),this.getLongestTiles(!0,100).forEach((function(e){return t.selectTile(e,!0)})),this.finishSelect(),this.scheduleOnce((function(){null!=i&&i.node.isValid&&(i.interactable=!0),t.setState(Y.READY_FOR_MOVE)}),1)}},n.getLongestTiles=function(e,t,n){if(void 0===t&&(t=13),void 0===n&&(n=0),n>=t)return[];var i=[];return this.getPossiblePath(this.tiles[Math.floor(Math.random()*this.tiles.length)],i,e),i.sort((function(e,t){return t.length-e.length})),i[0].length<3?this.getLongestTiles(e,t,n+1):i[0]},n.getPossiblePath=function(e,t,n){void 0===t&&(t=[]),this.tiles.forEach((function(e){return(null==e?void 0:e.isValid)&&e.setMark(0)}));var i=this.getMatchTiles(e),o=this.getLeaves(i);o.length<=0&&o.push(i[Math.floor(Math.random()*i.length)]);var r=[];this.backtrackTiles(o[Math.floor(Math.random()*o.length)],r);var a=this.connectTiles(r[0]);return t.push(a),t},n.getMatchTiles=function(e){for(var t=new Set,n=[e],i=e;n.length;)(i=n.shift()).setLabelStr(("0"+(10*i.row+i.col)).slice(-2)),t.add(i),this.getTileNeighbors(i).forEach((function(e){e&&e.type===i.type&&!t.has(e)&&n.push(e)}));return Array.from(t.values())},n.findLongestPath=function(e,t,n,i,o){if(void 0===i&&(i=0),void 0===o&&(o=[]),e.setMark(n),e.type!==t.type)return i;var r=Qe(e,this);if(o[r]=!0,e===t)return Math.max(n,i);for(var a=this.getTileNeighbors(e),l=0;l<a.length;l++)a[l]&&a[l].type===e.type&&!o[Qe(a[l],this)]&&(i=this.findLongestPath(a[l],t,n+1,i,o));return o[r]=!1,i},n.findLongestPathV2=function(e,t){if(void 0===t&&(t=e),!e||t.type!==e.type)return 0;if(-1!==e.mark)return e.mark;for(var n=this.getTileNeighbors(e),i=new Array(n.length).fill(-1),o=0,r=null;n.length,r=n[o];o++)r&&r.type===e.type&&(i[o]=1+this.findLongestPathV2(r,t));return e.setMark(Math.max.apply(Math,i)),e.mark},n.backtrackTiles=function(e,t,n,i,o){var r=this;void 0===n&&(n=Number.MAX_SAFE_INTEGER),void 0===i&&(i=1),void 0===o&&(o=[]);var a=Qe(e,this);if(!o[a]){o[a]=!0,e.setMark(i);var l=t[0];(!l||i>=l.mark)&&(t[0]=e),i>=n-1||(this.getTileNeighbors(e).filter((function(t){return t&&t.type===e.type&&!o[Qe(t,r)]})).forEach((function(e){r.backtrackTiles(e,t,n,i+1,o)})),o[a]=!1)}},n.getLeaves=function(e){var t=this,n=e[0];if(!n)return[];var i=new Set;return e.forEach((function(e){t.getTileNeighbors(e).filter((function(e){return e&&e.type===n.type})).length<=1&&i.add(e)})),Array.from(i.values())},n.connectTiles=function(e){for(var t=this,n=[e],i=[e],o=function(){var e=i.pop(),o=t.getTileNeighbors(e).filter((function(t){return t&&t.type===e.type&&t.mark===e.mark-1}))[0];o&&(n.push(o),i.push(o))};i.length;)o();return n},n.printTilesMark=function(){for(var e=0;e<this.row;e++){for(var t=[],n=0;n<this.col;n++){var i=Qe({row:e,col:n},this),o=this.tiles[i];o&&t.push(o)}console.log(t.map((function(e){return e.mark})).join("\t"))}},n.getTileNeighbors=function(e){return ot(e,this)},t}(a)).prototype,"row",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yt=k(mt.prototype,"col",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wt=k(mt.prototype,"moveTargetNode",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Et=k(mt.prototype,"healthComponent",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tt=k(mt.prototype,"levelLabel",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rt=k(mt.prototype,"damageLabel",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pt=k(mt.prototype,"nextLevelFX",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lt=k(mt.prototype,"selectFX",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ct=k(mt.prototype,"startMoveFX",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),St=k(mt.prototype,"damageFX",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=mt))||gt);e._RF.pop(),e._RF.push({},"fe870czUqVMbJQE2E4MqZfO","ButtonSelectorComponent",void 0);var jt,Kt,Jt,qt,Zt,$t,en=t.ccclass,tn=t.property,nn=t.requireComponent;Ot=en("ButtonSelectorComponent"),Nt=nn(P),kt=tn([u]),Ut=tn([u]),Vt=tn([u]),zt=tn([u]),Ot(xt=Nt((It=k((Bt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).btn=null,N(t,"normal",It,O(t)),N(t,"pressed",Gt,O(t)),N(t,"hover",Xt,O(t)),N(t,"disabled",Ht,O(t)),t}M(t,e);var n=t.prototype;return n.onLoad=function(){this.btn=this.getComponent(P)},n.start=function(){var e=globalThis.WEBP_SUPPORT?0:1;this.btn.isValid&&(this.btn.normalSprite=this.normal[e],this.btn.pressedSprite=this.pressed[e],this.btn.hoverSprite=this.hover[e],this.btn.disabledSprite=this.disabled[e])},t}(a)).prototype,"normal",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gt=k(Bt.prototype,"pressed",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xt=k(Bt.prototype,"hover",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ht=k(Bt.prototype,"disabled",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xt=Bt))||xt);e._RF.pop(),e._RF.push({},"5b1e9MT2TVGV5TO4GcnhjNt","SpriteSelectorComponent",void 0);var on,rn=t.ccclass,an=t.property,ln=t.requireComponent;jt=rn("SpriteSelectorComponent"),Kt=ln(n),Jt=an([u]),jt(qt=Kt(($t=k((Zt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).sprite=null,N(t,"frames",$t,O(t)),t}M(t,e);var i=t.prototype;return i.onLoad=function(){this.sprite=this.getComponent(n)},i.start=function(){var e,t=globalThis.WEBP_SUPPORT;null!=(e=this.sprite)&&e.isValid&&(this.sprite.spriteFrame=this.frames[t?0:1])},t}(a)).prototype,"frames",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qt=Zt))||qt);e._RF.pop(),e._RF.push({},"c57e5X/AhZCi7yaSFiqtNKg","common",void 0),e._RF.pop(),e._RF.push({},"84087VNPtlKApmlfemq4w1g","SpritePoolManager",void 0);var sn=t.ccclass;t.property,sn("SpritePoolManager")(on=function(e){function t(){return e.apply(this,arguments)||this}M(t,e);var n=t.prototype;return n.start=function(){},n.update=function(e){},t}(a));e._RF.pop(),e._RF.push({},"9d0d4Gj2z1BLr1ouL0eftbL","webp",void 0);var cn,un,hn,pn,fn,dn={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};function vn(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0==e.toDataURL("image/webp").indexOf("data:image/webp")}function bn(e,t){return new Promise((function(n){var i=new Image;i.onload=function(){var o=i.width>0&&i.height>0;t&&t(e,o),n(o)},i.onerror=function(){t&&t(e,!1),n(!1)},i.src="data:image/webp;base64,"+dn[e]}))}function gn(){return mn.apply(this,arguments)}function mn(){return(mn=S(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([bn("lossy"),bn("alpha"),bn("animation"),bn("lossless")]);case 2:return(t=e.sent).push(vn()),globalThis.WEBP_SUPPORT=t.reduce((function(e,t){return e&&t}),!0),e.abrupt("return",globalThis.WEBP_SUPPORT);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}globalThis.WEBP_SUPPORT=!0,e._RF.pop(),e._RF.push({},"08e4crlQKFPsIoh/VjxpPtv","preloadScene",void 0);var An,yn,wn,En,Tn,Rn,Pn,Ln,Cn,Sn,Fn=t.ccclass,_n=t.property;cn=Fn("preloadScene"),un=_n(i),cn((fn=k((pn=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"debugLabel",fn,O(t)),t}M(t,e);var n=t.prototype;return n.onLoad=function(){document.getElementById("GameCanvas").focus()},n.start=function(){var e=S(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.downloader.maxConcurrency=5,this.setDebug("Preload"),e.next=4,this.delay(200);case 4:return this.setDebug("Testing WebP"),e.next=7,gn();case 7:return t=e.sent,this.setDebug("WebP: "+t),e.next=11,this.delay(200);case 11:this.setDebug("Loading"),L.loadScene("test",(function(){Dt.stop()}));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.delay=function(e){return void 0===e&&(e=10),new Promise((function(t){setTimeout(t,e)}))},n.setDebug=function(e){var t;null!=(t=this.debugLabel)&&t.isValid&&(this.debugLabel.string=e)},n.update=function(e){},t}(a)).prototype,"debugLabel",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hn=pn));e._RF.pop(),e._RF.push({},"b119154aJtG6474xqBn3RBW","HexaBoardTest",void 0);var Mn=t.ccclass,Dn=t.property,On=t.executeInEditMode;An=Mn("hexrow"),yn=On(!0),wn=Dn(h),En=Dn({min:0}),Tn=Dn({min:0}),An(Rn=yn((Ln=k((Pn=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return N(t=e.call.apply(e,[this].concat(i))||this,"prefab",Ln,O(t)),N(t,"cols",Cn,O(t)),N(t,"rows",Sn,O(t)),t.childs=[],t.gapY=85,t.gapX=72.5,t}M(t,e);var n=t.prototype;return n.onLoad=function(){this.initialize()},n.initialize=function(){var e=this.cols*this.gapX/2-this.gapX/2,t=this.gapY/2;this.node.destroyAllChildren();for(var n=0;n<this.rows;n++)for(var i=0;i<this.cols;i++){var o=Ie.instance.spawnRandomTile().node,r=i*this.gapX-e,a=n*this.gapY+(i%2==1?this.gapY/2:0)+t;o.setPosition(r,a),o.setParent(this.node)}},t}(a)).prototype,"prefab",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cn=k(Pn.prototype,"cols",[En],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Sn=k(Pn.prototype,"rows",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Rn=Pn))||Rn);e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});