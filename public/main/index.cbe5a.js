System.register("chunks:///main.js",["cc"],(function(){"use strict";var e,t,n,i,o,r,a,l,s,c,u,h,p,f,d,v,b,m,g,A,y,w,E,T;return{setters:[function(R){e=R.cclegacy,t=R._decorator,n=R.Sprite,i=R.Label,o=R.math,r=R.tween,a=R.Component,l=R.EventTarget,s=R.instantiate,c=R.Enum,u=R.SpriteFrame,h=R.Prefab,p=R.AnimationClip,f=R.Node,d=R.UITransform,v=R.AnimationComponent,b=R.Vec3,m=R.resources,g=R.assetManager,A=R.find,y=R.path,w=R.Vec2,E=R.Button,T=R.director}],execute:function(){function R(e,t,n,i,o,r,a){try{var l=e[r](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(i,o)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){R(r,i,o,a,l,"next",e)}function l(e){R(r,i,o,a,l,"throw",e)}a(void 0)}))}}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function L(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function D(e,t,n,i,o){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var F,k,N,U,z,x,V,B,I;e._RF.push({},"c2a9emdCZ1GaaauoqkLXNyb","HealthComponent",void 0);var G,H,Y,W=t.ccclass,Q=t.property,X=(F=W("HealthComponent"),k=Q(n),N=Q(i),F((x=D((z=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(t=e.call.apply(e,[this].concat(i))||this,"healthSprite",x,M(t)),O(t,"healthLabel",V,M(t)),O(t,"maxHealth",B,M(t)),O(t,"health",I,M(t)),t.prevHealth=t.health,t}S(t,e);var n=t.prototype;return n.drawHealth=function(e,t){var n=this;void 0===e&&(e=this.percent),void 0===t&&(t=.3);var i=o.clamp01(e);if(this.healthSprite.isValid){var a=this.healthSprite.node,l=a.scale.clone();l.set(i,l.y,l.z),r(a).to(t,{scale:l}).start(),r(this).to(t,{prevHealth:i*this.maxHealth},{onUpdate:function(){n.healthLabel.isValid&&(n.healthLabel.string=n.prevHealth.toFixed(0))},onComplete:function(){n.healthLabel.isValid&&(n.healthLabel.string=n.prevHealth.toFixed(0))}}).start()}},n.start=function(){this.drawHealth(this.percent,.1)},L(t,[{key:"percent",get:function(){return this.health/this.maxHealth}}]),t}(a)).prototype,"healthSprite",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=D(z.prototype,"healthLabel",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=D(z.prototype,"maxHealth",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),I=D(z.prototype,"health",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),U=z))||U);e._RF.pop(),e._RF.push({},"a826eQ/3t9PApZXcT2ncZiB","BoardEnums",void 0),function(e){e[e.PREPARING=0]="PREPARING",e[e.READY_FOR_MOVE=1]="READY_FOR_MOVE",e[e.POPPING=2]="POPPING",e[e.SPAWNING_NEW_TILES=3]="SPAWNING_NEW_TILES"}(G||(G={})),e._RF.pop(),e._RF.push({},"1ea57CbwLxPB7cSic0eV6lb","PoolComponent",void 0);var j=t.ccclass,K=(t.property,j("PoolComponent")(((Y=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).eventTarget=new l,t}S(t,e);var n=t.prototype;return n.remove=function(e){void 0===e&&(e=!0),e&&this.node.removeFromParent(),this.eventTarget.emit(t.EventType.REMOVE,this)},n.pick=function(){this.eventTarget.emit(t.EventType.PICK,this)},t}(a)).EventType={REMOVE:"remove-pool",PICK:"pick-pool"},H=Y))||H);e._RF.pop(),e._RF.push({},"7c361JWEoFNEJkhRiUztGrs","PoolManager",void 0);var J,q,Z,$,ee,te,ne,ie,oe,re,ae,le,se,ce,ue,he,pe,fe,de=function(){function e(){this.prefab=null,this.pool=[]}var t=e.prototype;return t.testPoolComponent=function(e){var t=e.getComponent(K);return t||e.addComponent(K)},t.addToPool=function(e){this.pool.push(e)},t.pickOne=function(){if(!this.pool.length){var e,t=this.spawnObject();return null==(e=t.getComponent(K))||e.pick(),t}return this.pool.shift()},t.spawnObject=function(){var e=this;if(!this.prefab)throw new Error("Please initialize prefab pool");var t=s(this.prefab),n=this.testPoolComponent(t);return n.eventTarget.on(K.EventType.REMOVE,(function(t){e.addToPool(t)})),n.eventTarget.on(K.EventType.PICK,(function(t){var n=e.pool.indexOf(t);n<0||e.pool.splice(n,1)})),t},e}();e._RF.pop(),e._RF.push({},"a2e75wGa1xOT7JfbaQ3PFt9","TileEnums",void 0),function(e){e[e.BLUE=0]="BLUE",e[e.GREEN=1]="GREEN",e[e.GREY=2]="GREY",e[e.PINK=3]="PINK",e[e.RED=4]="RED",e[e.YELLOW=5]="YELLOW"}(J||(J={})),c(J),function(e){e[e.NORMAL=0]="NORMAL",e[e.PUSHED=1]="PUSHED",e[e.SELECTED=2]="SELECTED",e[e.MATCHED=3]="MATCHED"}(q||(q={})),c(q),e._RF.pop(),e._RF.push({},"bb3ec6e08dPZZthXHkBHle8","TileComponent",void 0);var ve,be,me,ge,Ae,ye,we,Ee,Te,Re,Pe,Ce,Le,Se,_e,Me,Oe=t.ccclass,De=t.property,Fe=t.requireComponent,ke=(Z=Oe("TileComponent"),$=Fe(n),ee=De({type:J}),te=De({type:q}),ne=De([u]),ie=De([u]),oe=De(h),re=De([p]),Z(ae=$((se=D((le=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(t=e.call.apply(e,[this].concat(i))||this,"type",se,M(t)),O(t,"state",ce,M(t)),O(t,"baseSprite",ue,M(t)),O(t,"pushedSprite",he,M(t)),O(t,"connect",pe,M(t)),t.connectNode=null,t.sprite=void 0,t.label=null,O(t,"animClips",fe,M(t)),t.row=-1,t.col=-1,t.mark=0,t}S(t,e);var o=t.prototype;return o.onLoad=function(){this.sprite=this.getComponent(n),this.getFXNode(),this.setState(this.state),this.initializeConnect()},o.start=function(){},o.getBoardID=function(){return this.row*Math.pow(10,3)+this.col},o.reset=function(){this.row=-1,this.col=-1,this.resetState(),this.showConnect(!1)},o.resetState=function(){this.setState(q.NORMAL)},o.getFXNode=function(){var e=this.node.getChildByName("FX");if(!e){(e=new f).name="FX",e.setParent(this.node),e.layer=this.node.layer;var t=e.addComponent(d);t.setContentSize(88,98),t.setAnchorPoint(.5,.5),e.addComponent(n);var i=e.addComponent(v);this.animClips.forEach((function(e){i.addClip(e)}))}return e},o.initializeConnect=function(){if(this.connect){var e=s(this.connect);e.name="connect",e.setParent(this.node),this.connectNode=e,this.showConnect(!1)}},o.initializeLabel=function(){var e=new f("label");e.setParent(this.node),e.layer=this.node.layer;var t=e.addComponent(i);this.label=t,this.setMark()},o.setMark=function(e){var t;if(void 0===e&&(e=this.mark),this.mark!==e&&void 0!==e&&(this.mark=e),null!=(t=this.label)&&t.node.isValid){var n=-1===e?"ðŸ’¡":0===e?"":this.mark.toString();this.label.string=n}},o.setLabelStr=function(e){var t;null!=(t=this.label)&&t.node.isValid&&(this.label.string=e)},o.connectPreviousTile=function(e,t){var n;if(void 0===t&&(t=!0),null!=e&&null!=(n=e.node)&&n.isValid){this.showConnect(t);var i=e.node,o=new b;b.subtract(o,i.position,this.node.position),b.normalize(o,o);var r=Math.atan2(o.y,o.x);this.rotateConnect(180*r/Math.PI-90)}else this.showConnect(!1)},o.showConnect=function(e){void 0===e&&(e=!0);var t=this.connectNode;t&&t.isValid&&(t.active=e)},o.rotateConnect=function(e){var t=this.connectNode;t&&t.isValid&&t.setRotationFromEuler(0,0,e)},o.setState=function(e){var t,n,i=this.getFXNode(),o=i.getComponent(v);e===q.MATCHED?i.setPosition(-4,0,0):i.setPosition(0,0,0),i.active=e>1;var r=globalThis.WEBP_SUPPORT;switch(e){case q.MATCHED:o.play((null==(t=o.clips[r?1:3])?void 0:t.name)||"");break;case q.SELECTED:o.play((null==(n=o.clips[r?0:2])?void 0:n.name)||"");break;case q.PUSHED:this.sprite.spriteFrame=this.pushedSprite[r?0:1];break;default:this.sprite.spriteFrame=this.baseSprite[r?0:1]}this.state=e},t}(a)).prototype,"type",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return J.GREY}}),ce=D(le.prototype,"state",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.NORMAL}}),ue=D(le.prototype,"baseSprite",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),he=D(le.prototype,"pushedSprite",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pe=D(le.prototype,"connect",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=D(le.prototype,"animClips",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ae=le))||ae)||ae);e._RF.pop(),e._RF.push({},"2272dYMsvpCqrzNl6Jot7DB","TileManager",void 0);var Ne=t.ccclass,Ue=t.property,ze=t.executionOrder,xe=(ve=Ne("TileManager"),be=ze(0),me=Ue(h),ge=Ue(h),Ae=Ue(h),ye=Ue(h),we=Ue(h),Ee=Ue(h),ve(Te=be((Pe=D((Re=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).tileAssets={},O(t,"blue",Pe,M(t)),O(t,"grey",Ce,M(t)),O(t,"green",Le,M(t)),O(t,"pink",Se,M(t)),O(t,"red",_e,M(t)),O(t,"yellow",Me,M(t)),t.pools={},t}S(t,e);var n=t.prototype;return n.onLoad=function(){var e=this;this.tileAssets[J.BLUE]="BLUE",this.tileAssets[J.GREEN]="Green",this.tileAssets[J.GREY]="GREY",this.tileAssets[J.PINK]="PINK",this.tileAssets[J.RED]="RED",this.tileAssets[J.YELLOW]="YELLOW",Object.keys(this.tileAssets).forEach((function(t){var n=new de;n.prefab=e.getPrefab(+t),e.pools[+t]=n}))},n.assetKey=function(e){return"Tile_"+J[e]},n.getAssetKey=function(e,t){void 0===t&&(t=0);var n=this.tileAssets[e];return 0===t?n:1===t?n.toUpperCase():n.toLowerCase()},n.parseTile=function(e){return"images/"+this.tileAssets[e]+"/spriteFrame"},n.loadAssets=function(){var e=this;Object.keys(this.tileAssets).forEach((function(t){var n=e.parseTile(t);m.get(n,u)||m.load(n,u,(function(n,i){n||g.assets.add(e.assetKey(+t),i)}))}))},n.getPrefab=function(e){var t=this.grey;switch(e){case J.BLUE:t=this.blue;break;case J.GREY:t=this.grey;break;case J.GREEN:t=this.green;break;case J.PINK:t=this.pink;break;case J.RED:t=this.red;break;case J.YELLOW:t=this.yellow}return t},n.spawnRandomTile=function(e){var t;for(void 0===e&&(e=[J.GREY]);!t||!J[t]||-1!==e.indexOf(t);)t=Math.floor(6*Math.random());return this.spawnTile(t)},n.spawnTile=function(e){var t=this.pools[e];if(!t)throw new Error("Tile not found");var n=t.pickOne();return n.name="Tile",n.getComponent(ke)},L(t,null,[{key:"instance",get:function(){var e,n=null==(e=A(y.join("TileManager")))?void 0:e.getComponent(t);if(!n)throw new Error("Add TileManager on scene first");return n}}]),t}(a)).prototype,"blue",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=D(Re.prototype,"grey",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=D(Re.prototype,"green",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=D(Re.prototype,"pink",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=D(Re.prototype,"red",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=D(Re.prototype,"yellow",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=Re))||Te)||Te);e._RF.pop(),e._RF.push({},"4a297IPpxVMqrWACKwt4Iua","BoardUtil",void 0);var Ve,Be=72.5,Ie=85;function Ge(e,t,n,i,o){void 0===n&&(n={x:0,y:0}),void 0===i&&(i=Be),void 0===o&&(o=Ie);var r=t.col*i/2-i/2,a=o/2;return n.x=e.col*i-r,n.y=e.row*o+(e.col%2==1?o/2:0)+a,n}function He(e,t,n,i,o){void 0===n&&(n={row:0,col:0}),void 0===i&&(i=Be),void 0===o&&(o=Ie);var r=t.col*i/2-i/2,a=o/2,l=Math.round((e.x+r)/i);0===l&&(l=0);var s=Math.round((e.y-((l%2==1?o/2:0)+a))/o);return 0===s&&(s=0),n.col=l,n.row=s,n}function Ye(e,t){return e.row*t.col+e.col}function We(e,t,n){return void 0===n&&(n=!0),function(e,t,n,i,o){void 0===o&&(o=!0);var r,a=i-t,l=n-e;r=o===(t%2==0)?st:ct;for(var s=!1,c=1,u=0,h=0;c<r.length;c+=2)if(u=r[c-1],h=r[c],u===l&&h===a){s=!0;break}return s}(e.row,e.col,t.row,t.col,n)}!function(e){e[e.U=0]="U",e[e.UR=1]="UR",e[e.DR=2]="DR",e[e.D=3]="D",e[e.DL=4]="DL",e[e.UL=5]="UL"}(Ve||(Ve={}));var Qe,Xe,je,Ke,Je,qe,Ze,$e,et,tt,nt,it,ot,rt,at,lt,st=[1,0,0,1,-1,1,-1,0,-1,-1,0,-1],ct=[1,0,1,1,0,1,-1,0,0,-1,1,-1];function ut(e,t,n){void 0===n&&(n=!0);var i,o=[];i=n===(e.col%2==0)?st:ct;var r=[];!function(e,t,n){void 0===n&&(n=[]);var i=t.row/2,o=t.col/2,r=e.row-i,a=e.col-o;r<0&&a<0?n.push(Ve.U,Ve.D,Ve.UR,Ve.DR,Ve.UL,Ve.DL):r<0&&a>0?n.push(Ve.U,Ve.D,Ve.UL,Ve.DL,Ve.UR,Ve.DR):r>0&&a<0?n.push(Ve.D,Ve.U,Ve.DR,Ve.UR,Ve.DL,Ve.UL):r>0&&a>0?n.push(Ve.D,Ve.U,Ve.DL,Ve.UL,Ve.DR,Ve.UR):n.push(Ve.U,Ve.UR,Ve.DR,Ve.D,Ve.DL,Ve.UL)}(e,t,r);for(var a=0,l=0,s=0,c=0;a<r.length;a++)if(s=i[2*(l=r[a])]+e.row,c=i[2*l+1]+e.col,!(s<0||c<0||s>=t.row||c>=t.col)){var u=Ye({row:s,col:c},t);o.push(t.tiles[u])}return o}e._RF.pop(),e._RF.push({},"db39cdbnalPsphRK09/h0sU","BoardComponent",void 0);var ht,pt,ft,dt,vt,bt,mt,gt,At,yt,wt,Et,Tt=t.ccclass,Rt=t.property,Pt=t.executionOrder;Qe=Tt("BoardComponent"),Xe=Pt(1),je=Rt({min:0}),Ke=Rt({min:0}),Je=Rt(f),qe=Rt(X),Ze=Rt(i),$e=Rt(i),Qe(et=Xe((nt=D((tt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(t=e.call.apply(e,[this].concat(i))||this,"row",nt,M(t)),O(t,"col",it,M(t)),O(t,"moveTargetNode",ot,M(t)),O(t,"healthComponent",rt,M(t)),O(t,"levelLabel",at,M(t)),t.level=1,O(t,"damageLabel",lt,M(t)),t.positions=[],t.tiles=[],t.selectedTiles=[],t.transform=void 0,t.state=G.PREPARING,t.eventTarget=new l,t}S(t,e);var n=t.prototype;return n.onLoad=function(){this.transform=this.getComponent(d),this.initialize()},n.initialize=function(){this.positions=function(e,t,n,i){void 0===n&&(n=Be),void 0===i&&(i=Ie);for(var o=t*n/2-n/2,r=i/2,a=[],l=0;l<e;l++)for(var s=0;s<t;s++){0===s&&(a[l]=[]);var c=s*n-o,u=l*i+(s%2==1?i/2:0)+r;a[l][s]={x:c,y:u}}return a}(this.row,this.col),this.initTiles(),this.setupTouchEvents(),this.setupEvents(),this.state=G.READY_FOR_MOVE},n.setupEvents=function(){var e=this;this.eventTarget.on("on-change-state",(function(t){t===G.SPAWNING_NEW_TILES&&e.dropTiles()}))},n.dropTiles=function(){for(var e,t=this,n=0,i=0,o=0;o<this.col;o++){n=0;for(var r=0;r<this.row;r++){var a;if(i=Ye({row:r,col:o},this),null==(a=e=this.tiles[i])||a.setMark(0),e?n&&this.moveTile(e,{col:o,row:e.row-n}):n++,r===this.row-1)for(var l=n-1;l>=0;l--)this.spawnTile({row:r-l,col:o})}}this.scheduleOnce((function(){t.setState(G.READY_FOR_MOVE)}),1.5)},n.calcDamage=function(e){for(var t=0,n=1;n<=e;n++)t+=10*n;return t},n.initTiles=function(){this.tiles.forEach((function(e){var t;null==(t=e.getComponent(K))||t.remove(!0)}));for(var e=0;e<this.positions.length;e++)for(var t=0;t<((null==(n=this.positions[e])?void 0:n.length)||0);t++){var n,i=xe.instance.spawnRandomTile(),o=this.positions[e][t];i.row=e,i.col=t,i.node.setPosition(o.x,o.y),i.node.setParent(this.node);var r=Ye({row:e,col:t},this);this.tiles[r]=i}},n.setState=function(e){this.state=e,this.eventTarget.emit("on-change-state",e,this)},n.getLocalPosFromTouch=function(e,t,n){n.getUILocation(t),e.set(t.x,t.y,0),this.node.inverseTransformPoint(e,e)},n.selectTile=function(e,t){if(void 0===t&&(t=!1),t||this.state===G.READY_FOR_MOVE){var n=Ye(e,this),i=this.tiles[n],o=this.selectedTiles[this.selectedTiles.length-1];if(i&&null!=i&&i.node.isValid&&i!==o){if(o){if(i.type!==o.type)return;if(!We(o,i))return;if(this.selectedTiles[this.selectedTiles.length-2]===i)return this.selectedTiles.splice(-1),o.setState(q.NORMAL),o.showConnect(!1),o.node.setSiblingIndex(0),i.node.removeFromParent(),this.node.addChild(i.node),void(2===this.selectedTiles.length&&this.selectedTiles.forEach((function(e){return e.setState(q.SELECTED)})))}if(-1===this.selectedTiles.indexOf(i)){this.selectedTiles.push(i),i.connectPreviousTile(o),i.node.removeFromParent(),this.node.addChild(i.node),i.setState(q.PUSHED);var r=this.selectedTiles.length>=3;if(3===this.selectedTiles.length&&this.selectedTiles.forEach((function(e){return e.setState(q.MATCHED)})),r){var a;i.setState(q.MATCHED);var l=i.col<this.col/2;null!=(a=this.damageLabel)&&a.isValid&&(this.damageLabel.node.active||(console.log("active"),this.damageLabel.node.active=!0),this.damageLabel.node.setPosition(i.node.position.clone().add3f(l?100:-100,0,0)),this.damageLabel.string=this.calcDamage(this.selectedTiles.length).toFixed(0),this.damageLabel.node.removeFromParent(),this.damageLabel.node.setParent(this.node))}else{var s;i.setState(q.SELECTED),null!=(s=this.damageLabel)&&s.isValid&&this.damageLabel.node.active&&(this.damageLabel.node.active=!1)}}}}},n.animMoveTiles=function(e,t){var n=this;this.setState(G.POPPING);var i=b.ONE.clone().multiplyScalar(.5),o=0;e.forEach((function(e,a,l){var s=1+.03*a*Math.random();o=Math.max(o,s),r(e.node).to(s,{position:t,scale:i},{easing:"backIn",onStart:function(){var s,c=Ye(e,n);(n.tiles[c]=void 0,e.showConnect(!1),a===l.length-1)&&(null!=(s=n.damageLabel)&&s.isValid&&r(n.damageLabel.node).to(o,{position:t,scale:i},{easing:"backIn",onComplete:function(){n.damageLabel.node.active=!1,n.damageLabel.node.scale.set(1,1,1)}}).start())},onComplete:function(){e.reset();var t=e.node.getComponent(K);if(t&&(t.remove(!0),a===l.length-1)){var i;if(n.setState(G.SPAWNING_NEW_TILES),null==(i=n.healthComponent)||!i.isValid)return;n.healthComponent.health-=n.calcDamage(a),n.healthComponent.health<=0&&(n.healthComponent.health=0),n.healthComponent.drawHealth(),n.scheduleOnce((function(){var e;n.healthComponent.health<=0&&(null!=(e=n.levelLabel)&&e.isValid&&(n.levelLabel.string="Level "+ ++n.level),n.healthComponent.maxHealth=2*n.healthComponent.maxHealth,n.healthComponent.health=n.healthComponent.maxHealth,n.healthComponent.drawHealth())}),.5)}}}).start()}))},n.finishSelect=function(){if(this.selectedTiles.length<3)this.clearSelectedTiles();else{var e=this.moveTargetNode.worldPosition.clone();this.node.inverseTransformPoint(e,e),this.animMoveTiles(this.selectedTiles.splice(0),e)}},n.clearSelectedTiles=function(){for(;this.selectedTiles.length;){var e=this.selectedTiles.pop();null==e||e.setState(q.NORMAL),null==e||e.showConnect(!1)}},n.setupTouchEvents=function(){var e=this,t=new w,n=new b,i={row:0,col:0};this.node.on(f.EventType.TOUCH_START,(function(o){e.getLocalPosFromTouch(n,t,o),He(n,e,i),e.selectTile(i)})),this.node.on(f.EventType.TOUCH_MOVE,(function(o){e.getLocalPosFromTouch(n,t,o),He(n,e,i),e.selectTile(i)})),this.node.on(f.EventType.TOUCH_END,(function(t){e.finishSelect()})),this.node.on(f.EventType.TOUCH_CANCEL,(function(e){}))},n.spawnTile=function(e,t,n){var i,o;null==(i=o=void 0!==t?xe.instance.spawnTile(J.BLUE):xe.instance.spawnRandomTile())||i.setMark(0);var r=Ge({row:this.row+2,col:e.col},this);o.node.setPosition(r.x,r.y,0),o.node.setScale(1,1,1),o.node.setParent(this.node),this.moveTile(o,e,.5,"circIn",n)},n.moveTile=function(e,t,n,i,o){var a=this;void 0===n&&(n=.5),void 0===i&&(i="backIn");var l={x:0,y:0};Ge(t,this,l);var s=new b(l.x,l.y,0);r(e.node).to(n,{position:s},{easing:i,onComplete:function(){var n=Ye(t,a);a.tiles[n]=e,e.row=t.row,e.col=t.col,"function"==typeof o&&o()}}).start()},n.shuffle=function(e){var t=this;if(this.state===G.READY_FOR_MOVE){var n=e.target,i=n instanceof f&&(null==n?void 0:n.getComponent(E));null!=i&&i.node.isValid&&(i.interactable=!1),this.setState(G.PREPARING),this.tiles=this.tiles.sort((function(e,t){return.5-Math.random()})),this.clearSelectedTiles(),this.tiles.forEach((function(e,n){var i=function(e,t,n){return{row:Math.floor(e/t),col:e%n}}(n,t.row,t.col);t.moveTile(e,i,.5,"linear")})),this.scheduleOnce((function(){null!=i&&i.node.isValid&&(i.interactable=!0),t.setState(G.READY_FOR_MOVE)}),.6)}},n.solve=function(e){var t=this;if(this.state===G.READY_FOR_MOVE){var n=e.target,i=n instanceof f&&(null==n?void 0:n.getComponent(E));null!=i&&i.node.isValid&&(i.interactable=!1),this.setState(G.PREPARING),this.clearSelectedTiles(),this.getLongestTiles(!0,100).forEach((function(e){return t.selectTile(e,!0)})),this.finishSelect(),this.scheduleOnce((function(){null!=i&&i.node.isValid&&(i.interactable=!0),t.setState(G.READY_FOR_MOVE)}),1)}},n.getLongestTiles=function(e,t,n){if(void 0===t&&(t=13),void 0===n&&(n=0),n>=t)return[];var i=[];return this.getPossiblePath(this.tiles[Math.floor(Math.random()*this.tiles.length)],i,e),i.sort((function(e,t){return t.length-e.length})),i[0].length<3?this.getLongestTiles(e,t,n+1):i[0]},n.getPossiblePath=function(e,t,n){void 0===t&&(t=[]),this.tiles.forEach((function(e){return(null==e?void 0:e.isValid)&&e.setMark(0)}));var i=this.getMatchTiles(e),o=this.getLeaves(i);o.length<=0&&o.push(i[Math.floor(Math.random()*i.length)]);var r=[];this.backtrackTiles(o[Math.floor(Math.random()*o.length)],r);var a=this.connectTiles(r[0]);return t.push(a),t},n.getMatchTiles=function(e){for(var t=new Set,n=[e],i=e;n.length;)(i=n.shift()).setLabelStr(("0"+(10*i.row+i.col)).slice(-2)),t.add(i),this.getTileNeighbors(i).forEach((function(e){e&&e.type===i.type&&!t.has(e)&&n.push(e)}));return Array.from(t.values())},n.findLongestPath=function(e,t,n,i,o){if(void 0===i&&(i=0),void 0===o&&(o=[]),e.setMark(n),e.type!==t.type)return i;var r=Ye(e,this);if(o[r]=!0,e===t)return Math.max(n,i);for(var a=this.getTileNeighbors(e),l=0;l<a.length;l++)a[l]&&a[l].type===e.type&&!o[Ye(a[l],this)]&&(i=this.findLongestPath(a[l],t,n+1,i,o));return o[r]=!1,i},n.findLongestPathV2=function(e,t){if(void 0===t&&(t=e),!e||t.type!==e.type)return 0;if(-1!==e.mark)return e.mark;for(var n=this.getTileNeighbors(e),i=new Array(n.length).fill(-1),o=0,r=null;n.length,r=n[o];o++)r&&r.type===e.type&&(i[o]=1+this.findLongestPathV2(r,t));return e.setMark(Math.max.apply(Math,i)),e.mark},n.backtrackTiles=function(e,t,n,i,o){var r=this;void 0===n&&(n=Number.MAX_SAFE_INTEGER),void 0===i&&(i=1),void 0===o&&(o=[]);var a=Ye(e,this);if(!o[a]){o[a]=!0,e.setMark(i);var l=t[0];(!l||i>=l.mark)&&(t[0]=e),i>=n-1||(this.getTileNeighbors(e).filter((function(t){return t&&t.type===e.type&&!o[Ye(t,r)]})).forEach((function(e){r.backtrackTiles(e,t,n,i+1,o)})),o[a]=!1)}},n.getLeaves=function(e){var t=this,n=e[0];if(!n)return[];var i=new Set;return e.forEach((function(e){t.getTileNeighbors(e).filter((function(e){return e&&e.type===n.type})).length<=1&&i.add(e)})),Array.from(i.values())},n.connectTiles=function(e){for(var t=this,n=[e],i=[e],o=function(){var e=i.pop(),o=t.getTileNeighbors(e).filter((function(t){return t&&t.type===e.type&&t.mark===e.mark-1}))[0];o&&(n.push(o),i.push(o))};i.length;)o();return n},n.printTilesMark=function(){for(var e=0;e<this.row;e++){for(var t=[],n=0;n<this.col;n++){var i=Ye({row:e,col:n},this),o=this.tiles[i];o&&t.push(o)}console.log(t.map((function(e){return e.mark})).join("\t"))}},n.getTileNeighbors=function(e){return ut(e,this)},t}(a)).prototype,"row",[je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),it=D(tt.prototype,"col",[Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ot=D(tt.prototype,"moveTargetNode",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=D(tt.prototype,"healthComponent",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=D(tt.prototype,"levelLabel",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt=D(tt.prototype,"damageLabel",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),et=tt))||et);e._RF.pop(),e._RF.push({},"fe870czUqVMbJQE2E4MqZfO","ButtonSelectorComponent",void 0);var Ct,Lt,St,_t,Mt,Ot,Dt=t.ccclass,Ft=t.property,kt=t.requireComponent;ht=Dt("ButtonSelectorComponent"),pt=kt(E),ft=Ft([u]),dt=Ft([u]),vt=Ft([u]),bt=Ft([u]),ht(mt=pt((At=D((gt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).btn=null,O(t,"normal",At,M(t)),O(t,"pressed",yt,M(t)),O(t,"hover",wt,M(t)),O(t,"disabled",Et,M(t)),t}S(t,e);var n=t.prototype;return n.onLoad=function(){this.btn=this.getComponent(E)},n.start=function(){var e=globalThis.WEBP_SUPPORT?0:1;this.btn.isValid&&(this.btn.normalSprite=this.normal[e],this.btn.pressedSprite=this.pressed[e],this.btn.hoverSprite=this.hover[e],this.btn.disabledSprite=this.disabled[e])},t}(a)).prototype,"normal",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yt=D(gt.prototype,"pressed",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wt=D(gt.prototype,"hover",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Et=D(gt.prototype,"disabled",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mt=gt))||mt);e._RF.pop(),e._RF.push({},"5b1e9MT2TVGV5TO4GcnhjNt","SpriteSelectorComponent",void 0);var Nt,Ut=t.ccclass,zt=t.property,xt=t.requireComponent;Ct=Ut("SpriteSelectorComponent"),Lt=xt(n),St=zt([u]),Ct(_t=Lt((Ot=D((Mt=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).sprite=null,O(t,"frames",Ot,M(t)),t}S(t,e);var i=t.prototype;return i.onLoad=function(){this.sprite=this.getComponent(n)},i.start=function(){var e,t=globalThis.WEBP_SUPPORT;null!=(e=this.sprite)&&e.isValid&&(this.sprite.spriteFrame=this.frames[t?0:1])},t}(a)).prototype,"frames",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_t=Mt))||_t);e._RF.pop(),e._RF.push({},"c57e5X/AhZCi7yaSFiqtNKg","common",void 0),e._RF.pop(),e._RF.push({},"84087VNPtlKApmlfemq4w1g","SpritePoolManager",void 0);var Vt=t.ccclass;t.property,Vt("SpritePoolManager")(Nt=function(e){function t(){return e.apply(this,arguments)||this}S(t,e);var n=t.prototype;return n.start=function(){},n.update=function(e){},t}(a));e._RF.pop(),e._RF.push({},"9d0d4Gj2z1BLr1ouL0eftbL","webp",void 0);var Bt,It,Gt,Ht,Yt,Wt={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};function Qt(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0==e.toDataURL("image/webp").indexOf("data:image/webp")}function Xt(e,t){return new Promise((function(n){var i=new Image;i.onload=function(){var o=i.width>0&&i.height>0;t&&t(e,o),n(o)},i.onerror=function(){t&&t(e,!1),n(!1)},i.src="data:image/webp;base64,"+Wt[e]}))}function jt(){return Kt.apply(this,arguments)}function Kt(){return(Kt=P(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Xt("lossy"),Xt("alpha"),Xt("animation"),Xt("lossless")]);case 2:return(t=e.sent).push(Qt()),globalThis.WEBP_SUPPORT=t.reduce((function(e,t){return e&&t}),!0),e.abrupt("return",globalThis.WEBP_SUPPORT);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}globalThis.WEBP_SUPPORT=!0,e._RF.pop(),e._RF.push({},"08e4crlQKFPsIoh/VjxpPtv","preloadScene",void 0);var Jt,qt,Zt,$t,en,tn,nn,on,rn,an,ln=t.ccclass,sn=t.property;Bt=ln("preloadScene"),It=sn(i),Bt((Yt=D((Ht=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(t=e.call.apply(e,[this].concat(i))||this,"debugLabel",Yt,M(t)),t}S(t,e);var n=t.prototype;return n.start=function(){var e=P(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.downloader.maxConcurrency=5,this.setDebug("Preload"),e.next=4,this.delay(200);case 4:return this.setDebug("Testing WebP"),e.next=7,jt();case 7:return t=e.sent,this.setDebug("WebP: "+t),e.next=11,this.delay(200);case 11:this.setDebug("Loading"),T.loadScene("test");case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.delay=function(e){return void 0===e&&(e=10),new Promise((function(t){setTimeout(t,e)}))},n.setDebug=function(e){var t;null!=(t=this.debugLabel)&&t.isValid&&(this.debugLabel.string=e)},n.update=function(e){},t}(a)).prototype,"debugLabel",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gt=Ht));e._RF.pop(),e._RF.push({},"b119154aJtG6474xqBn3RBW","HexaBoardTest",void 0);var cn=t.ccclass,un=t.property,hn=t.executeInEditMode;Jt=cn("hexrow"),qt=hn(!0),Zt=un(h),$t=un({min:0}),en=un({min:0}),Jt(tn=qt((on=D((nn=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return O(t=e.call.apply(e,[this].concat(i))||this,"prefab",on,M(t)),O(t,"cols",rn,M(t)),O(t,"rows",an,M(t)),t.childs=[],t.gapY=85,t.gapX=72.5,t}S(t,e);var n=t.prototype;return n.onLoad=function(){this.initialize()},n.initialize=function(){var e=this.cols*this.gapX/2-this.gapX/2,t=this.gapY/2;this.node.destroyAllChildren();for(var n=0;n<this.rows;n++)for(var i=0;i<this.cols;i++){var o=xe.instance.spawnRandomTile().node,r=i*this.gapX-e,a=n*this.gapY+(i%2==1?this.gapY/2:0)+t;o.setPosition(r,a),o.setParent(this.node)}},t}(a)).prototype,"prefab",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rn=D(nn.prototype,"cols",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),an=D(nn.prototype,"rows",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tn=nn))||tn);e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});